<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì›¹ìº  ì¸ì‹</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* === ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ === */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* === ë©”ì¸ ì»¨í…Œì´ë„ˆ === */
        .container {
            max-width: 600px;
            width: 100%;
            background: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #1a237e; /* ì§„í•œ ë‚¨ìƒ‰ */
            margin-top: 0;
            margin-bottom: 25px;
        }

        /* === ì›¹ìº  ìŠ¤íƒ€ì¼ === */
        #webcam-container {
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            /* ì›¹ìº  ìº”ë²„ìŠ¤ í¬ê¸°ì— ë§ê²Œ ì¡°ì • (JSì—ì„œ 300x300ìœ¼ë¡œ ì„¤ì •) */
            width: 300px;
            height: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* === ì˜ˆì¸¡ ê²°ê³¼ (ë¼ë²¨) ì»¨í…Œì´ë„ˆ === */
        #label-container {
            display: flex;
            flex-direction: column;
            gap: 15px; /* ê° í•­ëª© ì‚¬ì´ì˜ ê°„ê²© */
        }

        /* === ê°œë³„ ì˜ˆì¸¡ í•­ëª© (ë¼ë²¨ + ë°” + í¼ì„¼íŠ¸) === */
        .prediction-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-label {
            font-size: 16px;
            font-weight: 700;
            text-align: right;
            flex-basis: 30%; /* ë¼ë²¨ì´ ì°¨ì§€í•˜ëŠ” ê³µê°„ */
        }

        .prediction-bar-container {
            flex-grow: 1; /* ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€ */
            height: 24px;
            background-color: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .prediction-bar {
            height: 100%;
            background-color: #3f51b5; /* ì¸ë””ê³  ìƒ‰ìƒ */
            border-radius: 12px;
            transition: width 0.2s ease-in-out; /* ë„ˆë¹„ ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ íš¨ê³¼ */
            width: 0%; /* ê¸°ë³¸ ë„ˆë¹„ */
        }
        
        .prediction-percent {
            font-size: 16px;
            font-weight: 700;
            color: #3f51b5;
            flex-basis: 10%; /* í¼ì„¼íŠ¸ê°€ ì°¨ì§€í•˜ëŠ” ê³µê°„ */
            min-width: 40px; /* "100%"ê°€ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê²Œ */
            text-align: left;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ¤– AI ì›¹ìº  ì¸ì‹</h1>
        <div id="webcam-container"></div>
        
        <div id="label-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    
    <script type="text/javascript">
        // ëª¨ë¸ URL (ì„ ìƒë‹˜ ê³ ìœ  ëª¨ë¸ ì£¼ì†Œ)
        const URL = "https://teachablemachine.withgoogle.com/models/6IfxNkm2O/";

        let model, webcam, labelContainer, maxPredictions;

        // Load the image model and setup the webcam
        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // ëª¨ë¸ê³¼ ë©”íƒ€ë°ì´í„° ë¡œë“œ
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // ì›¹ìº  ì„¤ì •
            const flip = true; // ì¢Œìš° ë°˜ì „
            const webcamSize = 300; // ì›¹ìº  í¬ê¸° (CSSì™€ ë§ì¶¤)
            webcam = new tmImage.Webcam(webcamSize, webcamSize, flip);
            await webcam.setup(); // ì›¹ìº  ì ‘ê·¼ ê¶Œí•œ ìš”ì²­
            await webcam.play();
            window.requestAnimationFrame(loop);

            // ì›¹ìº  ìº”ë²„ìŠ¤ë¥¼ DOMì— ì¶”ê°€
            document.getElementById("webcam-container").appendChild(webcam.canvas);
            
            // ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í‘œì‹œí•  DOM ìƒì„±
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                // ê° í•­ëª©(ë¼ë²¨ + ë°” + í¼ì„¼íŠ¸)ì„ ê°ìŒ€ div ìƒì„±
                const wrapper = document.createElement("div");
                wrapper.className = "prediction-wrapper";
                labelContainer.appendChild(wrapper);
            }
        }

        async function loop() {
            webcam.update(); // ì›¹ìº  í”„ë ˆì„ ì—…ë°ì´íŠ¸
            await predict();
            window.requestAnimationFrame(loop);
        }

        // ì›¹ìº  ì´ë¯¸ì§€ë¥¼ ëª¨ë¸ë¡œ ì˜ˆì¸¡
        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            
            for (let i = 0; i < maxPredictions; i++) {
                // [ìˆ˜ì •] ì‹ ë¢°ë„ë¥¼ 0~100 ì‚¬ì´ì˜ ì •ìˆ˜ë¡œ ë³€í™˜
                const probability = prediction[i].probability;
                const percent = (probability * 100).toFixed(0); // ì†Œìˆ˜ì  ë²„ë¦¬ê³  ì •ìˆ˜ë¡œ
                const className = prediction[i].className;

                // [ìˆ˜ì •] ìŠ¤íƒ€ì¼ë§ëœ HTML êµ¬ì¡°ë¡œ ì—…ë°ì´íŠ¸
                const predictionHTML = `
                    <div class="prediction-label">${className}</div>
                    <div class="prediction-bar-container">
                        <div class="prediction-bar" style="width: ${percent}%;"></div>
                    </div>
                    <div class="prediction-percent">${percent}%</div>
                `;
                
                // í•´ë‹¹ ë¼ë²¨ ì»¨í…Œì´ë„ˆì˜ ë‚´ìš©ì„ HTMLë¡œ ì‚½ì…
                labelContainer.childNodes[i].innerHTML = predictionHTML;
            }
        }
        
        // [ìˆ˜ì •] ì‹œì‘ ë²„íŠ¼ ì—†ì´ init() í•¨ìˆ˜ë¥¼ ë°”ë¡œ í˜¸ì¶œí•˜ì—¬ ìë™ ì‹œì‘
        init();
        
    </script>
</body>
</html>
